{% extends "layout.html" %}

{% block title %}
Feed
{% endblock %}

{% block main %}
<div class="container mx-auto px-auto" style="display: flex; flex-direction: column;">

    {% block postar %}{% endblock %}

    {% for proposta in todas_propostas_nao_privadas %}
    {% set classe_background = "bg-" + proposta.tipo_proposta %}
    {% set id_modal_comentarios = "modal_comentarios_" + proposta.id | string %}
    {% set id_item_feed = "id_item_feed_" + proposta.id | string %}

    <div id="{{ id_item_feed }}" class="card mx-auto mt-3 item-feed {{ classe_background }}">
        <div class="card-top botao-favoritar-proposta"
            style="text-align: start; padding: 16px 0 0 16px; margin-bottom: -10px;">
            <a class="anchor-favoritar-proposta" onclick="favoritar_proposta('{{ proposta.id }}')">
                {% if proposta in user.propostas_favoritas %}
                <i class="bi bi-star-fill"></i>
                {% else %}
                <i class="bi bi-star"></i>
                {% endif %}
            </a>
        </div>
        <div class="card-body">
            <h5 class="card-title lato-bold fs-5" style="text-align: start;">{{ proposta.titulo }}</h5>
            {% if proposta.mes_criacao < 10 %} <h6 class="card-subtitle mb-2 text-muted lato-regular fs-6"
                style="text-align: start;">{{ proposta.dia_criacao }}/0{{ proposta.mes_criacao }}/{{
                proposta.ano_criacao }}</h6>
                {% else %}
                <h6 class="card-subtitle mb-2 text-muted lato-regular fs-6" style="text-align: start;">{{
                    proposta.dia_criacao
                    }}/{{ proposta.mes_criacao }}/{{ proposta.ano_criacao }}</h6>
                {% endif %}
                <div class="categorias-proposta">
                    {% for categoria in proposta.categorias %}
                    <h6 class="card-subtitle mb-2 text-muted categorias-proposta-item">{{ categoria.nome }}
                    </h6>
                    {% endfor %}
                </div>
                <p class="card-text lato-regular descricao-do-card" style="text-align: justify;">{{ proposta.descricao
                    }}</p>
                <div class="comentar-participar-likear-feed">
                    <a class="anchor-like-proposta" onclick="likear_proposta('{{ proposta.id }}', '{{ id_item_feed }}')"
                        style="text-decoration: none;">
                        {% if proposta in user.propostas_que_dei_like %}
                        <i class="bi bi-hand-thumbs-up-fill botao-like-proposta"></i>
                        {% else %}
                        <i class="bi bi-hand-thumbs-up botao-like-proposta"></i>
                        {% endif %}
                        <h3 class="lato-regular like-count fs-5" style="display: inline-block;">{{ proposta.likes |
                            length }}
                        </h3>
                    </a>
                    <button type="button" class="card-link btn btn-info lato-bold" data-bs-toggle="modal"
                        data-bs-target="#{{ id_modal_comentarios }}">Comentar</button>
                    <button type="button" class="card-link btn btn-primary lato-bold solicitar_participar_butao"
                        onclick="pedir_para_participar('{{ proposta.id }}')">Solicitar para
                        participar</button>
                </div>
        </div>
    </div>

    <div class="modal fade modal-lg" id="{{ id_modal_comentarios }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" novalidate>
                        <div class="mb-2">
                            <textarea class="form-control postar-comentario lato-regular fs-5" maxlength="1000"
                                name="texto_comentario" placeholder="ComentÃ¡rio"></textarea>
                            <span class="text-danger lato-bold postar_comentario_span fs-5"
                                style="margin-top: 6px; margin-bottom: 5px;"></span>
                        </div>
                        <button type="button" class="btn btn-info lato-bold fs-5"
                            onclick="enviar_comentario('{{ proposta.id }}', '{{ id_modal_comentarios }}')"
                            style="display: block; width: fit-content;">Comentar</button>
                    </form>
                    <div class="mx-auto mt-3 comentarios_da_proposta">
                        {% for comentario in proposta.comentarios %}
                        {% set id_card_comentario = "id_card_comentario_" + comentario.id | string %}
                        <div class="card mx-auto mt-3 card_do_comentario" id="{{ id_card_comentario }}">
                            <div class="card-body">
                                <h6 class="card-title lato-bold card_de_comentario_titulo fs-5">
                                    {{ comentario.dono_do_comentario }}
                                </h6>
                                {% if comentario.mes_criacao < 10 %} <p
                                    class="card-subtitle mb-2 text-muted lato-regular card_de_comentario_subtitulo fs-6">
                                    {{
                                    comentario.dia_criacao }}/0{{ comentario.mes_criacao }}/{{
                                    comentario.ano_criacao }}</p>
                                    {% else %}
                                    <p
                                        class="card-subtitle mb-2 text-muted lato-regular card_de_comentario_subtitulo fs-6">
                                        {{
                                        comentario.dia_criacao
                                        }}/{{ comentario.mes_criacao }}/{{ comentario.ano_criacao }}</p>
                                    {% endif %}
                                    <p class="card-text card_de_comentario_text lato-regular tamanho-padrao">
                                        {{ comentario.texto_comentario }}
                                    </p>
                                    <div class="div-do-like">
                                        <a class="anchor-like-comentario"
                                            onclick="likear_comentario('{{ comentario.id }}', '{{ id_card_comentario }}')"
                                            style="text-decoration: none;">
                                            {% if comentario in user.comentarios_que_dei_like %}
                                            <i class="bi bi-hand-thumbs-up-fill botao-like-comentario"></i>
                                            {% else %}
                                            <i class="bi bi-hand-thumbs-up botao-like-comentario"></i>
                                            {% endif %}
                                            <h3 class="lato-regular like-count fs-5" style="display: inline-block;">{{
                                                comentario.likes | length }}
                                            </h3>
                                        </a>
                                    </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary lato-bold" data-bs-dismiss="modal">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% endfor %}

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div class="toast toast-padrao align-items-center text-bg-primary border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body lato-regular">
                    Hello, world! This is a toast message.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
        <div class="toast toast-sucesso align-items-center text-bg-primary bg-success border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body lato-regular">
                    Hello, world! This is a toast message.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
        <div class="toast toast-erro align-items-center text-bg-primary bg-danger border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body lato-regular">
                    Hello, world! This is a toast message.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>
</div>
{% endblock %}